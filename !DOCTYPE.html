<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>語音⇄文字 轉換 Demo</title>
  <style>
    body { font-family: sans-serif; margin: 2em; background: #f9f9f9; }
    .section { margin-bottom: 2em; padding: 1em; background: #fff; border-radius: 8px; }
    textarea { width: 100%; height: 100px; }
    .controls { margin-top: 1em; }
    button { margin-right: 0.6em; }
  </style>
</head>
<body>
  <h1>語音⇄文字 Demo 頁面</h1>

  <div class="section">
    <h2>語音轉文字</h2>
    <button id="start-rec">開始錄音</button>
    <button id="stop-rec" disabled>停止錄音</button>
    <div class="controls">
      <textarea id="stt-result" placeholder="語音轉文字結果會顯示在這裡..."></textarea>
    </div>
  </div>

  <div class="section">
    <h2>文字轉語音</h2>
    <textarea id="tts-input" placeholder="請輸入要朗讀的文字..."></textarea>
    <div class="controls">
      <button id="play-tts">播放</button>
      <button id="pause-tts">暫停</button>
      <button id="resume-tts">繼續</button>
      <button id="stop-tts">停止</button>
    </div>
  </div>

<script>
let recognition, isRecording = false;

if ('webkitSpeechRecognition' in window) { // 目前 Chrome 支援
  recognition = new webkitSpeechRecognition();
  recognition.lang = 'zh-TW';
  recognition.continuous = true;
  recognition.interimResults = true;
} else {
  alert('本 demo 僅支援部分現代瀏覽器（建議用 Chrome）');
}

const startRecBtn = document.getElementById('start-rec');
const stopRecBtn = document.getElementById('stop-rec');
const sttResult = document.getElementById('stt-result');

startRecBtn.onclick = function() {
  if (!isRecording) {
    recognition.start();
    isRecording = true;
    startRecBtn.disabled = true;
    stopRecBtn.disabled = false;
  }
};

stopRecBtn.onclick = function() {
  if (isRecording) {
    recognition.stop();
    isRecording = false;
    startRecBtn.disabled = false;
    stopRecBtn.disabled = true;
  }
};

if (recognition) {
  recognition.onresult = function(event) {
    let transcript = '';
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      transcript += event.results[i][0].transcript;
    }
    sttResult.value = transcript;
  };

  recognition.onerror = function(event) {
    alert('語音辨識出錯: ' + event.error);
  };
}

// 文字轉語音
const ttsInput = document.getElementById('tts-input');
const playBtn = document.getElementById('play-tts');
const pauseBtn = document.getElementById('pause-tts');
const resumeBtn = document.getElementById('resume-tts');
const stopBtn = document.getElementById('stop-tts');

let synth = window.speechSynthesis;
let utter;

playBtn.onclick = function() {
  utter = new SpeechSynthesisUtterance(ttsInput.value);
  utter.lang = 'zh-TW';
  synth.speak(utter);
};

pauseBtn.onclick = function() {
  if (synth.speaking) synth.pause();
};
resumeBtn.onclick = function() {
  if (synth.paused) synth.resume();
};
stopBtn.onclick = function() {
  synth.cancel();
};
</script>
</body>
</html>
